package grpb.presentation.controller.produit;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import grpb.metier.service.ServiceResponse;
import grpb.metier.service.produit.IServiceProduit;
import grpb.presentation.controller.AbstractGlobals;
import grpb.presentation.controller.AccessValidator;
import grpb.presentation.dto.produit.GestionProduitDto;
import grpb.presentation.dto.produit.bean.ProduitDto;
import grpb.presentation.dto.tri.SortByType;

/**
 * Controlleur pour l'écran de gestion des produits.
 * 
 * @author Soann Dewasme, Souhil Omeiri
 * 
 */
@Controller
@RequestMapping("/gestionProduit")
public class GestionProduitController {

	// FIXME SOA Javadoc

	@Autowired
	public IServiceProduit serviceProduit;

	/**
	 * Affiche la page de gestion de produit.
	 * 
	 * @param referenceProduit
	 *            La référence produit à rechercher.
	 * @param model
	 *            Le modèle associé.
	 * @return Le nom de la JSP.
	 */
	@RequestMapping(method = RequestMethod.GET)
	String showGestionProduit(final @ModelAttribute("gestionProduitDto") ProduitDto produitDto, final Model model,
			final HttpSession session, final String reference, final SortByType tri) {
		// Check accès
		if (!AccessValidator.validateAccess(AbstractGlobals.PAGE_GESTION_PRODUIT,
				(String) session.getAttribute(AbstractGlobals.SESSION_ROLE_NAME))) {
			session.setAttribute(AbstractGlobals.GLOBAL_ERROR_MSG, "access.notAuthorized");
			return "redirect:/" + AbstractGlobals.PAGE_ACCUEIL;
		}

		// TODO AFFECT Passage reference + tri
		final ServiceResponse serviceResponse = serviceProduit
				.getListeProduitGestion(new SortByType(SortByType.ORDER_ASC), "");
		final GestionProduitDto gestionProduitDto = (GestionProduitDto) serviceResponse.getDataResult();
		model.addAttribute("gestionProduitDto", gestionProduitDto.getListProduit());
		return AbstractGlobals.PAGE_GESTION_PRODUIT;
	}

}
